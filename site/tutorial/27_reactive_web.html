<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reactive Web Framework (RWeb) - Nostos Tutorial</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <style>
        .hljs-operator {
            color: #e06c75;
        }
        .hljs-function {
            color: #e5c07b;
        }
    </style>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        nostos: {
                            dark: '#0f172a',
                            primary: '#3b82f6',
                            accent: '#10b981',
                            code: '#1e293b'
                        }
                    },
                    fontFamily: {
                        mono: ['ui-monospace', 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', "Liberation Mono", "Courier New", 'monospace'],
                    }
                }
            }
        }
    </script>

    

    <style>
        html, body { max-width: 100vw; overflow-x: hidden; }
        pre { max-width: 100%; overflow-x: auto; white-space: pre; }
        code { word-break: break-word; }
        p, li, h1, h2, h3, h4 { word-wrap: break-word; overflow-wrap: break-word; }
        .prose { max-width: 100%; }
        article, main, .content { max-width: 100%; overflow-x: hidden; }
        * { box-sizing: border-box; }
        @media (max-width: 768px) {
            .flex-1 { min-width: 0; }
            pre { font-size: 12px; }
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-200 font-sans antialiased overflow-x-hidden">

        <!-- Navbar -->
    <nav class="border-b border-slate-800 bg-slate-900/80 backdrop-blur fixed w-full z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center">
                    <button id="mobile-menu-btn" class="md:hidden text-slate-300 hover:text-white mr-3">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                    <a href="../index.html" class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-emerald-400">Nostos</a>
                    <span class="ml-4 text-slate-400 border-l border-slate-700 pl-4 text-sm font-medium hidden sm:inline">Tutorial</span>
                </div>
                <div class="hidden md:flex space-x-6">
                    <a href="../index.html" class="text-slate-400 hover:text-white transition">Home</a>
                    <a href="https://github.com/pegesund/nostos" class="text-slate-400 hover:text-white transition">GitHub</a>
                </div>
                
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden border-t border-slate-800 bg-slate-900">
            <div class="px-4 py-3 space-y-2">
                <a href="../index.html" class="block text-slate-300 hover:text-white transition py-2">Home</a>
                <a href="https://github.com/pegesund/nostos" class="block text-slate-300 hover:text-white transition py-2">GitHub</a>
                <div class="border-t border-slate-700 pt-3 mt-3">
                    <div class="text-xs text-slate-500 uppercase font-semibold mb-2">Chapters</div>
                    <div id="mobile-chapters"><a href="00_installation.html" class="block text-slate-300 hover:text-white py-1 text-sm">0. Installation</a>
                    <a href="01_basics.html" class="block text-slate-300 hover:text-white py-1 text-sm">1. Basics</a>
                    <a href="02_functions.html" class="block text-slate-300 hover:text-white py-1 text-sm">2. Functions</a>
                    <a href="03_pattern_matching.html" class="block text-slate-300 hover:text-white py-1 text-sm">3. Pattern Matching</a>
                    <a href="04_lists_tuples.html" class="block text-slate-300 hover:text-white py-1 text-sm">4. Lists & Tuples</a>
                    <a href="05_maps_sets.html" class="block text-slate-300 hover:text-white py-1 text-sm">5. Maps & Sets</a>
                    <a href="06_typed_arrays.html" class="block text-slate-300 hover:text-white py-1 text-sm">6. Typed Arrays</a>
                    <a href="07_type_system.html" class="block text-slate-300 hover:text-white py-1 text-sm">7. Type System</a>
                    <a href="08_traits.html" class="block text-slate-300 hover:text-white py-1 text-sm">8. Traits</a>
                    <a href="09_builtin_traits.html" class="block text-slate-300 hover:text-white py-1 text-sm">9. Builtin Traits</a>
                    <a href="10_trait_bounds.html" class="block text-slate-300 hover:text-white py-1 text-sm">10. Trait Bounds</a>
                    <a href="11_error_handling.html" class="block text-slate-300 hover:text-white py-1 text-sm">11. Error Handling</a>
                    <a href="12_modules.html" class="block text-slate-300 hover:text-white py-1 text-sm">12. Modules</a>
                    <a href="13_stdlib.html" class="block text-slate-300 hover:text-white py-1 text-sm">13. Std Library</a>
                    <a href="14_json.html" class="block text-slate-300 hover:text-white py-1 text-sm">14. JSON</a>
                    <a href="15_concurrency.html" class="block text-slate-300 hover:text-white py-1 text-sm">15. Concurrency</a>
                    <a href="16_async_runtime.html" class="block text-slate-300 hover:text-white py-1 text-sm">16. Async Runtime</a>
                    <a href="17_async_io_http.html" class="block text-slate-300 hover:text-white py-1 text-sm">17. Async I/O</a>
                    <a href="18_reflection.html" class="block text-slate-300 hover:text-white py-1 text-sm">18. Reflection</a>
                    <a href="19_debugging_profiling.html" class="block text-slate-300 hover:text-white py-1 text-sm">19. Debugging</a>
                    <a href="20_html_templating.html" class="block text-slate-300 hover:text-white py-1 text-sm">20. HTML</a>
                    <a href="21_mutability.html" class="block text-slate-300 hover:text-white py-1 text-sm">21. Mutability</a>
                    <a href="23_complete_web_app.html" class="block text-slate-300 hover:text-white py-1 text-sm">22. Web App</a>
                    <a href="24_ffi.html" class="block text-slate-300 hover:text-white py-1 text-sm">23. FFI</a>
                    <a href="25_command_line.html" class="block text-slate-300 hover:text-white py-1 text-sm">24. CLI</a>
                    <a href="26_reactive_records.html" class="block text-slate-300 hover:text-white py-1 text-sm">25. Reactive Records</a>
                    <a href="27_reactive_web.html" class="block text-slate-300 hover:text-white py-1 text-sm">26. RWeb</a>
                    <a href="28_logging.html" class="block text-slate-300 hover:text-white py-1 text-sm">27. Logging</a>
                    <a href="29_selenium.html" class="block text-slate-300 hover:text-white py-1 text-sm">28. Selenium</a>
                    <a href="30_tcp_sockets.html" class="block text-slate-300 hover:text-white py-1 text-sm">29. TCP Sockets</a>
                    <a href="31_vscode.html" class="block text-slate-300 hover:text-white py-1 text-sm">30. VS Code</a></div>
                </div>
            </div>
        </div>
    </nav>
    <script>
        document.getElementById('mobile-menu-btn').addEventListener('click', function() {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        });
    </script>

    <div class="pt-16 flex min-h-screen">

        <!-- Sidebar (will be populated by JS) -->
        <aside id="tutorial-sidebar" class="w-64 fixed top-16 h-[calc(100vh-4rem)] border-r border-slate-800 bg-slate-900 overflow-y-auto hidden md:block pb-8">
        </aside>

        <!-- Main Content -->
        <main class="flex-1 md:ml-64 p-8 max-w-4xl">
            <div class="mb-12">
                <h1 class="text-4xl font-bold text-white mb-6">Reactive Web Framework (RWeb)</h1>
                <p class="text-lg text-slate-400 leading-relaxed mb-8">
                    RWeb is Nostos's built-in reactive web framework that enables you to build interactive web applications with automatic UI updates. It combines <strong>reactive records</strong>, <strong>WebSocket communication</strong>, and <strong>server-side rendering</strong> to create a seamless developer experience without requiring a separate frontend framework.
                </p>

                <div class="bg-gradient-to-r from-blue-900/30 to-emerald-900/30 rounded-lg p-6 mb-8 border border-slate-700">
                    <h3 class="text-lg font-semibold text-white mb-2">What Makes RWeb Special?</h3>
                    <ul class="text-slate-300 space-y-2">
                        <li><strong>Process per Session:</strong> Each browser session gets its own Nostos process with isolated state</li>
                        <li><strong>Automatic Updates:</strong> Changes to reactive records automatically update the browser UI via WebSocket</li>
                        <li><strong>Server-Side Logic:</strong> All application logic runs on the server - no JavaScript framework needed</li>
                        <li><strong>Component-Based:</strong> Define reusable components that track their dependencies and re-render efficiently</li>
                    </ul>
                </div>

                <!-- Prerequisites -->
                <h2 class="text-2xl font-semibold text-white mb-4">Prerequisites</h2>
                <p class="text-slate-400 mb-4">
                    Before learning RWeb, make sure you understand:
                </p>
                <ul class="list-disc list-inside text-slate-400 mb-8 space-y-2">
                    <li><a href="26_reactive_records.html" class="text-blue-400 hover:underline">Reactive Records</a> - The foundation of RWeb state management</li>
                    <li><a href="20_html_templating.html" class="text-blue-400 hover:underline">HTML Templating</a> - The rhtml module for building HTML</li>
                </ul>

                <!-- Getting Started -->
                <h2 class="text-2xl font-semibold text-white mb-4">Getting Started: A Simple Counter</h2>
                <p class="text-slate-400 mb-4">
                    Let's start with the classic counter example. This demonstrates the core concepts of RWeb:
                </p>
                <div class="bg-nostos-code rounded-lg p-6 mb-8 border border-slate-800 overflow-x-auto">
<pre style="max-width:100%;overflow-x:auto"><code class="language-nostos">use stdlib.rweb
use stdlib.rhtml

# Define reactive state - each session gets its own instance
reactive Counter = { count: Int }

# Session function - called once per browser session
session() = {
    counter = Counter(count: 0)

    # Return tuple: (render function, action handler)
    (
        # Render function - returns the UI
        () => RHtml(div([
            h1("Simple Counter"),
            p("Count: " ++ show(counter.count)),
            button("+1", dataAction: "increment"),
            button("-1", dataAction: "decrement"),
            button("Reset", dataAction: "reset")
        ])),

        # Action handler - processes user interactions
        (action, params) => match action {
            "increment" -> counter.count = counter.count + 1
            "decrement" -> counter.count = counter.count - 1
            "reset" -> counter.count = 0
            _ -> ()
        }
    )
}

main() = {
    println("Starting counter app on port 8080...")
    startRWeb(8080, "Counter App", session)
}</code></pre>
                </div>

                <p class="text-slate-400 mb-4">
                    Run this with <code class="bg-slate-800 px-2 py-1 rounded">./target/release/nostos counter.nos</code> and open <code class="bg-slate-800 px-2 py-1 rounded">http://localhost:8080</code> in your browser.
                </p>

                <!-- Running RWeb Apps -->
                <h2 class="text-2xl font-semibold text-white mb-4">Running RWeb Applications</h2>
                <p class="text-slate-400 mb-4">
                    RWeb provides several functions for starting servers, designed for different use cases:
                </p>

                <div class="overflow-x-auto mb-6">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="border-b border-slate-700">
                                <th class="py-3 px-4 text-slate-300">Function</th>
                                <th class="py-3 px-4 text-slate-300">Behavior</th>
                                <th class="py-3 px-4 text-slate-300">Use Case</th>
                            </tr>
                        </thead>
                        <tbody class="text-slate-400">
                            <tr class="border-b border-slate-800">
                                <td class="py-3 px-4"><code>runRWeb</code></td>
                                <td class="py-3 px-4">Auto-detects mode: background in TUI, foreground in scripts</td>
                                <td class="py-3 px-4"><strong>Recommended</strong> - works everywhere</td>
                            </tr>
                            <tr class="border-b border-slate-800">
                                <td class="py-3 px-4"><code>startRWeb</code></td>
                                <td class="py-3 px-4">Blocks forever serving requests</td>
                                <td class="py-3 px-4">Scripts that run as servers</td>
                            </tr>
                            <tr class="border-b border-slate-800">
                                <td class="py-3 px-4"><code>restartRWebBackground</code></td>
                                <td class="py-3 px-4">Runs in background, auto-kills previous server</td>
                                <td class="py-3 px-4">TUI/REPL development with hot-reload</td>
                            </tr>
                            <tr class="border-b border-slate-800">
                                <td class="py-3 px-4"><code>startRWebBackground</code></td>
                                <td class="py-3 px-4">Runs in background, returns Pid</td>
                                <td class="py-3 px-4">Manual process management</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h3 class="text-xl font-semibold text-white mb-3">Smart Mode with runRWeb</h3>
                <p class="text-slate-400 mb-4">
                    The <code>runRWeb</code> function automatically chooses the right behavior based on context:
                </p>

                <div class="bg-nostos-code rounded-lg p-6 mb-6 border border-slate-800 overflow-x-auto">
<pre style="max-width:100%;overflow-x:auto"><code class="language-nostos">use stdlib.rweb
use stdlib.rhtml

reactive Counter = { count: Int }

session() = {
    counter = Counter(count: 0)
    (
        () => RHtml(div([
            h1("Counter: " ++ show(counter.count)),
            button("+1", dataAction: "inc")
        ])),
        (action, _) => match action {
            "inc" -> counter.count = counter.count + 1
            _ -> ()
        }
    )
}

# This single line works in both script and TUI/REPL!
main() = runRWeb(8080, "Counter", session)</code></pre>
                </div>

                <div class="bg-gradient-to-r from-blue-900/30 to-emerald-900/30 rounded-lg p-6 mb-6 border border-slate-700">
                    <h4 class="text-lg font-semibold text-white mb-2">How runRWeb Works</h4>
                    <ul class="text-slate-300 space-y-2">
                        <li><strong>In TUI/REPL:</strong> Uses <code>restartRWebBackground</code> - runs in background, auto-kills previous server when you re-run</li>
                        <li><strong>In scripts:</strong> Uses <code>startRWeb</code> - blocks and serves requests until killed</li>
                        <li><strong>Detection:</strong> Uses <code>Env.isInteractive()</code> to check if running in TUI</li>
                    </ul>
                </div>

                <h3 class="text-xl font-semibold text-white mb-3">Hot-Reload Development Workflow</h3>
                <p class="text-slate-400 mb-4">
                    When developing in the TUI, you can modify your code and re-run to see changes instantly:
                </p>

                <div class="bg-slate-800/50 rounded-lg p-4 mb-6 border border-slate-700">
                    <ol class="text-slate-400 text-sm space-y-2 list-decimal list-inside">
                        <li>Open your RWeb file in the TUI editor</li>
                        <li>Run with <kbd class="bg-slate-700 px-2 py-1 rounded">Ctrl+R</kbd></li>
                        <li>Open <code>http://localhost:8080</code> in your browser</li>
                        <li>Edit code, press <kbd class="bg-slate-700 px-2 py-1 rounded">Ctrl+R</kbd> again</li>
                        <li>Refresh browser - previous server is auto-killed, new one starts</li>
                    </ol>
                </div>

                <h3 class="text-xl font-semibold text-white mb-3">Custom Mode Detection</h3>
                <p class="text-slate-400 mb-4">
                    You can use <code>Env.isInteractive()</code> for custom logic:
                </p>

                <div class="bg-nostos-code rounded-lg p-6 mb-8 border border-slate-800 overflow-x-auto">
<pre style="max-width:100%;overflow-x:auto"><code class="language-nostos"># Check if running in TUI/REPL
main() = {
    if Env.isInteractive() then {
        println("Running in TUI - starting background server")
        pid = restartRWebBackground(8080, "Dev Server", session)
        println("Server running, pid stored for restart")
        pid
    } else {
        println("Running as script - blocking mode")
        startRWeb(8080, "Production Server", session)
    }
}</code></pre>
                </div>

                <div class="bg-slate-800/50 rounded-lg p-4 mb-8 border border-slate-700">
                    <h4 class="text-white font-semibold mb-2">How It Works</h4>
                    <ol class="text-slate-400 text-sm space-y-2 list-decimal list-inside">
                        <li>When a browser connects, RWeb spawns a new process and calls your <code>session()</code> function</li>
                        <li>The render function is called to generate the initial HTML</li>
                        <li>When the user clicks a button with <code>dataAction</code>, a WebSocket message is sent to the server</li>
                        <li>Your action handler receives the action name and modifies the reactive record</li>
                        <li>RWeb detects the change and sends an updated HTML fragment back to the browser</li>
                    </ol>
                </div>

                <!-- Understanding the Session Pattern -->
                <h2 class="text-2xl font-semibold text-white mb-4">Understanding the Session Pattern</h2>
                <p class="text-slate-400 mb-4">
                    The <code>session()</code> function is the heart of an RWeb application. It returns a tuple containing two functions:
                </p>

                <div class="bg-nostos-code rounded-lg p-6 mb-6 border border-slate-800 overflow-x-auto">
<pre style="max-width:100%;overflow-x:auto"><code class="language-nostos"># The session function signature
session: () -> (() -> RHtml | RHtmlResult, (String, Map[String, String]) -> ())

# Breaking it down:
# 1. render: () -> RHtml | RHtmlResult
#    - Takes no arguments
#    - Returns HTML (either simple RHtml or component-based RHtmlResult)
#
# 2. handler: (action, params) -> ()
#    - action: String - the action name from dataAction/dataOnchange/etc
#    - params: Map[String, String] - parameters sent with the action
#    - Returns nothing (side effect: modifies reactive records)</code></pre>
                </div>

                <p class="text-slate-400 mb-8">
                    The key insight is that your <strong>reactive record</strong> (like <code>Counter</code>) is captured in the closure. When the action handler modifies it, RWeb automatically detects the change and re-renders the affected parts of the UI.
                </p>

                <!-- Using Components -->
                <h2 class="text-2xl font-semibold text-white mb-4">Using Components for Efficient Updates</h2>
                <p class="text-slate-400 mb-4">
                    Simple RWeb apps re-render the entire page on every change. For larger apps, use <strong>components</strong> to update only the parts that changed:
                </p>

                <div class="bg-nostos-code rounded-lg p-6 mb-8 border border-slate-800 overflow-x-auto">
<pre style="max-width:100%;overflow-x:auto"><code class="language-nostos">use stdlib.rweb
use stdlib.rhtml

reactive State = { counter: Int, message: String }

session() = {
    state = State(counter: 0, message: "Hello!")

    (
        () => RHtml(div([
            h1("Component Demo"),

            # This component only re-renders when state.counter changes
            component("counter-display", () => RHtml(div([
                h3("Counter"),
                p("Value: " ++ show(state.counter)),
                button("+", dataAction: "inc"),
                button("-", dataAction: "dec")
            ]))),

            # This component only re-renders when state.message changes
            component("message-display", () => RHtml(div([
                h3("Message"),
                p(state.message),
                button("Change", dataAction: "changeMsg")
            ])))
        ])),

        (action, params) => match action {
            "inc" -> state.counter = state.counter + 1
            "dec" -> state.counter = state.counter - 1
            "changeMsg" -> state.message = "Updated at " ++ show(state.counter)
            _ -> ()
        }
    )
}

main() = startRWeb(8080, "Component Demo", session)</code></pre>
                </div>

                <p class="text-slate-400 mb-4">
                    The <code>component(id, renderFn)</code> function:
                </p>
                <ul class="list-disc list-inside text-slate-400 mb-8 space-y-2">
                    <li><strong>id:</strong> A unique identifier for this component (becomes the HTML element's id)</li>
                    <li><strong>renderFn:</strong> A function that returns RHtml for this component</li>
                    <li><strong>Dependency tracking:</strong> RWeb tracks which reactive fields each component reads</li>
                    <li><strong>Selective updates:</strong> Only components affected by a change are re-rendered</li>
                </ul>

                <!-- Form Handling -->
                <h2 class="text-2xl font-semibold text-white mb-4">Form Handling</h2>
                <p class="text-slate-400 mb-4">
                    RWeb supports various form elements with automatic WebSocket communication. Use named parameters to configure element behavior:
                </p>

                <h3 class="text-xl font-semibold text-white mb-3">Form Submission</h3>
                <div class="bg-nostos-code rounded-lg p-6 mb-6 border border-slate-800 overflow-x-auto">
<pre style="max-width:100%;overflow-x:auto"><code class="language-nostos">use stdlib.rweb
use stdlib.rhtml

reactive FormData = { name: String, email: String }

session() = {
    data = FormData(name: "", email: "")

    (
        () => RHtml(div([
            h1("Registration Form"),

            # Display submitted data
            p("Name: " ++ data.name),
            p("Email: " ++ data.email),

            # The form with dataAction triggers on submit
            form([
                div([
                    label("Name: "),
                    input(inputType: "text", name: "name", placeholder: "Your name")
                ]),
                div([
                    label("Email: "),
                    input(inputType: "email", name: "email", placeholder: "you@example.com")
                ]),
                button("Submit", btnType: "submit")
            ], dataAction: "submitForm")
        ])),

        (action, params) => match action {
            "submitForm" -> {
                # Form data is automatically collected into params
                data.name = Map.get(params, "name")
                data.email = Map.get(params, "email")
            }
            _ -> ()
        }
    )
}

main() = startRWeb(8080, "Form Demo", session)</code></pre>
                </div>

                <div class="bg-slate-800/50 rounded-lg p-4 mb-8 border border-slate-700">
                    <p class="text-slate-400 text-sm"><strong>Note:</strong> When a form with <code>dataAction</code> is submitted, RWeb automatically collects all form field values into the <code>params</code> map, keyed by the input's <code>name</code> attribute.</p>
                </div>

                <h3 class="text-xl font-semibold text-white mb-3">Checkboxes and Radio Buttons</h3>
                <div class="bg-nostos-code rounded-lg p-6 mb-6 border border-slate-800 overflow-x-auto">
<pre style="max-width:100%;overflow-x:auto"><code class="language-nostos">use stdlib.rweb
use stdlib.rhtml

reactive Prefs = { darkMode: Bool, newsletter: Bool }

session() = {
    prefs = Prefs(darkMode: false, newsletter: true)

    (
        () => RHtml(div([
            h1("Preferences"),

            p("Dark Mode: " ++ if prefs.darkMode then "ON" else "OFF"),
            p("Newsletter: " ++ if prefs.newsletter then "Subscribed" else "Unsubscribed"),

            div([
                input(inputType: "checkbox", name: "darkMode", dataOnchange: "toggleDark"),
                label(" Enable Dark Mode")
            ]),
            div([
                input(inputType: "checkbox", name: "newsletter", dataOnchange: "toggleNews"),
                label(" Subscribe to Newsletter")
            ])
        ])),

        (action, params) => match action {
            "toggleDark" -> {
                # params.checked is "true" or "false" for checkboxes
                checked = Map.get(params, "checked")
                prefs.darkMode = checked == "true"
            }
            "toggleNews" -> {
                checked = Map.get(params, "checked")
                prefs.newsletter = checked == "true"
            }
            _ -> ()
        }
    )
}

main() = startRWeb(8080, "Checkbox Demo", session)</code></pre>
                </div>

                <h3 class="text-xl font-semibold text-white mb-3">Select Dropdowns</h3>
                <div class="bg-nostos-code rounded-lg p-6 mb-6 border border-slate-800 overflow-x-auto">
<pre style="max-width:100%;overflow-x:auto"><code class="language-nostos">use stdlib.rweb
use stdlib.rhtml

reactive Selection = { country: String }

session() = {
    sel = Selection(country: "")

    (
        () => RHtml(div([
            h1("Country Selector"),
            p("Selected: " ++ if sel.country == "" then "None" else sel.country),

            select([
                option("Choose a country...", value: ""),
                option("United States", value: "us"),
                option("United Kingdom", value: "uk"),
                option("Canada", value: "ca"),
                option("Australia", value: "au")
            ], name: "country", dataOnchange: "countryChanged")
        ])),

        (action, params) => match action {
            "countryChanged" -> sel.country = Map.get(params, "value")
            _ -> ()
        }
    )
}

main() = startRWeb(8080, "Select Demo", session)</code></pre>
                </div>

                <h3 class="text-xl font-semibold text-white mb-3">Real-Time Input (oninput)</h3>
                <p class="text-slate-400 mb-4">
                    For instant feedback as the user types, use <code>dataOninput</code> instead of <code>dataOnchange</code>:
                </p>
                <div class="bg-nostos-code rounded-lg p-6 mb-8 border border-slate-800 overflow-x-auto">
<pre style="max-width:100%;overflow-x:auto"><code class="language-nostos">use stdlib.rweb
use stdlib.rhtml

reactive Search = { query: String }

session() = {
    search = Search(query: "")

    (
        () => RHtml(div([
            h1("Live Search"),
            input(inputType: "text", placeholder: "Type to search...", dataOninput: "search"),
            p("Searching for: " ++ search.query),
            p("Results: " ++ show(String.length(search.query)) ++ " characters typed")
        ])),

        (action, params) => match action {
            "search" -> search.query = Map.get(params, "value")
            _ -> ()
        }
    )
}

main() = startRWeb(8080, "Live Search", session)</code></pre>
                </div>

                <!-- Event Attributes Reference -->
                <h2 class="text-2xl font-semibold text-white mb-4">Event Attributes Reference</h2>
                <div class="overflow-x-auto mb-8">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="border-b border-slate-700">
                                <th class="py-3 px-4 text-slate-300">Attribute</th>
                                <th class="py-3 px-4 text-slate-300">Elements</th>
                                <th class="py-3 px-4 text-slate-300">Params Sent</th>
                                <th class="py-3 px-4 text-slate-300">Use Case</th>
                            </tr>
                        </thead>
                        <tbody class="text-slate-400">
                            <tr class="border-b border-slate-800">
                                <td class="py-3 px-4"><code>dataAction</code></td>
                                <td class="py-3 px-4">button, a, div, form</td>
                                <td class="py-3 px-4">Click: data-param-* attrs<br>Form: all input values</td>
                                <td class="py-3 px-4">Buttons, links, form submission</td>
                            </tr>
                            <tr class="border-b border-slate-800">
                                <td class="py-3 px-4"><code>dataOnchange</code></td>
                                <td class="py-3 px-4">input, select, textarea</td>
                                <td class="py-3 px-4">value, checked (for checkbox/radio)</td>
                                <td class="py-3 px-4">Form field changes (on blur or selection)</td>
                            </tr>
                            <tr class="border-b border-slate-800">
                                <td class="py-3 px-4"><code>dataOninput</code></td>
                                <td class="py-3 px-4">input, textarea</td>
                                <td class="py-3 px-4">value</td>
                                <td class="py-3 px-4">Real-time input feedback (every keystroke)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Form Validation -->
                <h2 class="text-2xl font-semibold text-white mb-4">Form Validation</h2>
                <p class="text-slate-400 mb-4">
                    RWeb supports a layered validation approach for robust form handling:
                </p>

                <h3 class="text-xl font-semibold text-white mb-3">HTML5 Client-Side Validation</h3>
                <p class="text-slate-400 mb-4">
                    Form inputs support HTML5 validation attributes for instant client-side feedback:
                </p>

                <div class="bg-nostos-code rounded-lg p-6 mb-8 border border-slate-800 overflow-x-auto">
<pre style="max-width:100%;overflow-x:auto"><code class="language-nostos"># HTML5 validation attributes on form inputs
form([
    # Required field with minimum length
    input(inputType: "text", name: "username", required: "true", minLength: "3", maxLength: "20"),

    # Email validation
    input(inputType: "email", name: "email", required: "true"),

    # Number with range
    input(inputType: "number", name: "age", min: "18", max: "120"),

    # Pattern matching (regex)
    input(inputType: "text", name: "phone", pattern: "[0-9]{10}", placeholder: "10 digits"),

    button("Submit", btnType: "submit")
], dataAction: "register")</code></pre>
                </div>

                <div class="bg-emerald-900/20 border border-emerald-500/30 rounded-lg p-4 mb-8">
                    <p class="text-slate-400 text-sm"><strong>Tip:</strong> Use <code>novalidate: "novalidate"</code> on the form to disable HTML5 validation for server-side only validation.</p>
                </div>

                <h3 class="text-xl font-semibold text-white mb-3">Server-Side Validation</h3>
                <p class="text-slate-400 mb-4">
                    For defense in depth, use the <code>stdlib.validation</code> library for server-side validation:
                </p>

                <div class="bg-nostos-code rounded-lg p-6 mb-8 border border-slate-800 overflow-x-auto">
<pre style="max-width:100%;overflow-x:auto"><code class="language-nostos">use stdlib.validation.{validate, required, minLength, maxLength, email, minValue, maxValue, Valid, Invalid, firstError}

# Define validation rules
makeRules() = {
    r1 = Map.insert(%{}, "username", [required(), minLength(3), maxLength(20)])
    r2 = Map.insert(r1, "email", [required(), email()])
    Map.insert(r2, "age", [required(), minValue(18), maxValue(120)])
}

# In your action handler:
(action, params) => match action {
    "register" -> {
        result = validate(params, makeRules())
        match result {
            Valid(data) -> {
                state.success = true
                state.username = Map.get(data, "username")
            }
            Invalid(errors) -> {
                state.error = firstError(result)
            }
        }
    }
    _ -> ()
}</code></pre>
                </div>

                <h3 class="text-xl font-semibold text-white mb-3">Available Validators</h3>
                <div class="bg-nostos-code rounded-lg p-6 mb-8 border border-slate-800 overflow-x-auto">
                    <table class="w-full text-left">
                        <thead>
                            <tr class="border-b border-slate-700">
                                <th class="py-3 px-4 text-slate-300">Validator</th>
                                <th class="py-3 px-4 text-slate-300">Description</th>
                            </tr>
                        </thead>
                        <tbody class="text-slate-400">
                            <tr class="border-b border-slate-800">
                                <td class="py-3 px-4"><code>required()</code></td>
                                <td class="py-3 px-4">Field must not be empty</td>
                            </tr>
                            <tr class="border-b border-slate-800">
                                <td class="py-3 px-4"><code>minLength(n)</code></td>
                                <td class="py-3 px-4">Minimum string length</td>
                            </tr>
                            <tr class="border-b border-slate-800">
                                <td class="py-3 px-4"><code>maxLength(n)</code></td>
                                <td class="py-3 px-4">Maximum string length</td>
                            </tr>
                            <tr class="border-b border-slate-800">
                                <td class="py-3 px-4"><code>email()</code></td>
                                <td class="py-3 px-4">Must contain @ and .</td>
                            </tr>
                            <tr class="border-b border-slate-800">
                                <td class="py-3 px-4"><code>minValue(n)</code></td>
                                <td class="py-3 px-4">Minimum numeric value</td>
                            </tr>
                            <tr class="border-b border-slate-800">
                                <td class="py-3 px-4"><code>maxValue(n)</code></td>
                                <td class="py-3 px-4">Maximum numeric value</td>
                            </tr>
                            <tr class="border-b border-slate-800">
                                <td class="py-3 px-4"><code>range(min, max)</code></td>
                                <td class="py-3 px-4">Value must be within range</td>
                            </tr>
                            <tr class="border-b border-slate-800">
                                <td class="py-3 px-4"><code>matchesField(field, params)</code></td>
                                <td class="py-3 px-4">Must match another field (e.g., password confirmation)</td>
                            </tr>
                            <tr class="border-b border-slate-800">
                                <td class="py-3 px-4"><code>custom(predicate, msg)</code></td>
                                <td class="py-3 px-4">Custom validation with predicate function</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Multi-Route Applications -->
                <h2 class="text-2xl font-semibold text-white mb-4">Multi-Route Applications</h2>
                <p class="text-slate-400 mb-4">
                    For applications with multiple pages, use <code>startRWebWithRoutes</code> with resolver functions:
                </p>

                <div class="bg-nostos-code rounded-lg p-6 mb-8 border border-slate-800 overflow-x-auto">
<pre style="max-width:100%;overflow-x:auto"><code class="language-nostos">use stdlib.rweb.{startRWebWithRoutes}
use stdlib.rhtml.{div, h1, p, button, a}
use stdlib.server.{respondHtml, respondJson}

reactive HomeState = { count: Int }
reactive DashState = { total: Int }

# Reactive session for home page
# Receives writerId (for external push) and cookies from HTTP request
homeSession(writerId, cookies) = {
    state = HomeState(count: 0)
    (
        () => RHtml(div([
            h1("Home"),
            p("Counter: " ++ show(state.count)),
            button("+", dataAction: "inc"),
            a("Go to Dashboard", href: "/dashboard")
        ])),
        (action, _) => match action {
            "inc" -> state.count = state.count + 1
            _ -> ()
        }
    )
}

# Reactive session for dashboard
dashSession(writerId, cookies) = {
    state = DashState(total: 100)
    (
        () => RHtml(div([
            h1("Dashboard"),
            p("Total: $" ++ show(state.total)),
            button("Add $10", dataAction: "add10"),
            a("Go to Home", href: "/")
        ])),
        (action, _) => match action {
            "add10" -> state.total = state.total + 10
            _ -> ()
        }
    )
}

# Reactive resolver: path -> Option[sessionFn]
reactiveResolver(path) = match path {
    "/" -> Some(homeSession)
    "/dashboard" -> Some(dashSession)
    _ -> None()
}

# Plain resolver: path -> Option[handler]
# For static HTML, API endpoints, etc.
plainResolver(path) = match path {
    "/about" -> Some(req => respondHtml(req, "&lt;h1&gt;About Us&lt;/h1&gt;"))
    "/api/health" -> Some(req => respondJson(req, "{\"status\":\"ok\"}"))
    _ -> None()
}

main() = {
    println("Starting multi-route app on port 8080...")
    startRWebWithRoutes(8080, "Multi-Route App", reactiveResolver, plainResolver)
}</code></pre>
                </div>

                <div class="bg-slate-800/50 rounded-lg p-4 mb-8 border border-slate-700">
                    <h4 class="text-white font-semibold mb-2">Resolver Functions</h4>
                    <ul class="text-slate-400 text-sm space-y-2">
                        <li><code>reactiveResolver(path) -> Option[(writerId, cookies) -> Session]</code> - Returns a session setup function</li>
                        <li><code>plainResolver(path) -> Option[Request -> ()]</code> - Returns a plain HTTP handler</li>
                        <li>Session functions receive <code>writerId</code> (Int) and <code>cookies</code> (List[(String, String)])</li>
                        <li>Return <code>None()</code> for paths you don't handle</li>
                    </ul>
                </div>

                <!-- Static File Serving -->
                <h2 class="text-2xl font-semibold text-white mb-4">Static File Serving</h2>
                <p class="text-slate-400 mb-4">
                    For applications that need to serve CSS, JavaScript, images, and other static assets, use <code>startRWebFull</code>:
                </p>

                <div class="bg-nostos-code rounded-lg p-6 mb-8 border border-slate-800 overflow-x-auto">
<pre style="max-width:100%;overflow-x:auto"><code class="language-nostos">use stdlib.rweb.{startRWebFull}
use stdlib.rhtml.{div, h1, link, script, img}
use stdlib.server.{respondJson}

reactive AppState = { theme: String }

appSession(writerId, cookies) = {
    state = AppState(theme: "light")
    (
        () => RHtml(div([
            # Link to static CSS file
            link(href: "/static/css/style.css", rel: "stylesheet"),

            h1("My App"),
            img(src: "/static/images/logo.png", alt: "Logo"),
            p("Current theme: " ++ state.theme),
            button("Toggle Theme", dataAction: "toggle"),

            # Link to static JavaScript
            script(src: "/static/js/app.js")
        ])),
        (action, _) => match action {
            "toggle" -> state.theme = if state.theme == "light" then "dark" else "light"
            _ -> ()
        }
    )
}

reactiveResolver(path) = match path {
    "/" -> Some(appSession)
    _ -> None()
}

plainResolver(path) = match path {
    "/api/status" -> Some(req => respondJson(req, "{\"ok\":true}"))
    _ -> None()
}

# Static file configuration: list of (urlPrefix, directory) tuples
staticConfig = [
    ("/static", "./public"),      # /static/css/style.css -> ./public/css/style.css
    ("/assets", "./assets")       # /assets/logo.png -> ./assets/logo.png
]

main() = {
    startRWebFull(8080, "My App", reactiveResolver, plainResolver, staticConfig)
}</code></pre>
                </div>

                <div class="bg-gradient-to-r from-blue-900/30 to-emerald-900/30 rounded-lg p-6 mb-8 border border-slate-700">
                    <h4 class="text-white font-semibold mb-2">Request Routing Order</h4>
                    <p class="text-slate-400 mb-2">When a request comes in, RWeb checks handlers in this order:</p>
                    <ol class="text-slate-300 space-y-1 list-decimal list-inside">
                        <li><strong>Reactive pages</strong> - WebSocket-enabled pages with live updates</li>
                        <li><strong>Plain handlers</strong> - API endpoints, static HTML pages</li>
                        <li><strong>Static files</strong> - CSS, JS, images from configured directories</li>
                        <li><strong>404 fallback</strong> - If nothing matches</li>
                    </ol>
                </div>

                <div class="bg-slate-800/50 rounded-lg p-4 mb-8 border border-slate-700">
                    <h4 class="text-white font-semibold mb-2">Supported MIME Types</h4>
                    <p class="text-slate-400 text-sm mb-2">Static files are served with correct Content-Type headers:</p>
                    <ul class="text-slate-400 text-sm space-y-1">
                        <li><strong>Text:</strong> .html, .css, .js, .json, .svg, .txt, .xml</li>
                        <li><strong>Images:</strong> .png, .jpg, .jpeg, .gif, .webp, .ico</li>
                        <li><strong>Fonts:</strong> .woff, .woff2, .ttf, .otf, .eot</li>
                        <li><strong>Media:</strong> .mp3, .mp4, .webm</li>
                        <li><strong>Other:</strong> .pdf, .zip, .wasm</li>
                    </ul>
                </div>

                <!-- Cookie Handling -->
                <h2 class="text-2xl font-semibold text-white mb-4">Cookie Handling</h2>
                <p class="text-slate-400 mb-4">
                    RWeb passes cookies from the HTTP request to your session setup function. This enables authentication flows and persistent user preferences:
                </p>

                <div class="bg-nostos-code rounded-lg p-6 mb-6 border border-slate-800 overflow-x-auto">
<pre style="max-width:100%;overflow-x:auto"><code class="language-nostos">use stdlib.rweb.{startRWebWithRoutes}
use stdlib.rhtml.{div, h1, p, button, form, input}
use stdlib.server.{getCookie, hasCookie, setCookie, setCookieWithAge, clearCookie, respondHtmlWith, redirect, redirectWith}

reactive UserState = { username: String, loggedIn: Bool }

# Check authentication on session start
appSession(writerId, cookies) = {
    # Read session token from cookies
    sessionToken = getCookie(cookies, "session")
    isLoggedIn = sessionToken != ""

    state = UserState(
        username: if isLoggedIn then "User" else "",
        loggedIn: isLoggedIn
    )

    (
        () => RHtml(div([
            h1("Welcome!"),
            if state.loggedIn then
                div([
                    p("Hello, " ++ state.username),
                    button("Logout", dataAction: "logout")
                ])
            else
                form([
                    input(inputType: "text", name: "username", placeholder: "Username"),
                    button("Login", btnType: "submit")
                ], dataAction: "login")
        ])),
        (action, params) => match action {
            "login" -> {
                state.username = Map.get(params, "username")
                state.loggedIn = true
            }
            "logout" -> {
                state.loggedIn = false
                state.username = ""
            }
            _ -> ()
        }
    )
}

reactiveResolver(path) = match path {
    "/" -> Some(appSession)
    _ -> None()
}

# Plain resolver for login/logout that sets cookies
plainResolver(path) = match path {
    "/auth/login" -> Some(req => {
        # In real app: validate credentials, create session
        cookie = setCookieWithAge("session", "abc123", 86400)  # 24 hours
        redirectWith(req, "/", [cookie])
    })
    "/auth/logout" -> Some(req => {
        cookie = clearCookie("session")
        redirectWith(req, "/", [cookie])
    })
    _ -> None()
}

main() = startRWebWithRoutes(8080, "Auth Demo", reactiveResolver, plainResolver)</code></pre>
                </div>

                <div class="bg-slate-800/50 rounded-lg p-4 mb-8 border border-slate-700">
                    <h4 class="text-white font-semibold mb-2">Cookie Helper Functions (from stdlib.server)</h4>
                    <ul class="text-slate-400 text-sm space-y-2">
                        <li><code>getCookie(cookies, name)</code> - Get cookie value (returns "" if not found)</li>
                        <li><code>hasCookie(cookies, name)</code> - Check if cookie exists</li>
                        <li><code>setCookie(name, value)</code> - Create Set-Cookie header (HttpOnly, Path=/)</li>
                        <li><code>setCookieWithAge(name, value, maxAge)</code> - With max age in seconds</li>
                        <li><code>setSecureCookie(name, value, maxAge)</code> - HTTPS only with SameSite=Strict</li>
                        <li><code>clearCookie(name)</code> - Delete cookie (Max-Age=0)</li>
                    </ul>
                </div>

                <h3 class="text-xl font-semibold text-white mb-3">Setting Cookies via WebSocket</h3>
                <p class="text-slate-400 mb-4">
                    For simpler flows, you can set cookies directly from within your reactive action handler using <code>rwebSetCookie</code>. This sends a WebSocket message that tells the browser to set the cookie via JavaScript:
                </p>

                <div class="bg-nostos-code rounded-lg p-6 mb-6 border border-slate-800 overflow-x-auto">
<pre style="max-width:100%;overflow-x:auto"><code class="language-nostos">use stdlib.rweb.{startRWeb, rwebSetCookie, rwebClearCookie}
use stdlib.rhtml.{div, h1, p, button, form, input}
use stdlib.server.{getCookie}

reactive AppState = { username: String, loggedIn: Bool }

appSession(writerId, cookies) = {
    # Read cookie on page load
    savedUser = getCookie(cookies, "user")
    state = AppState(
        username: if savedUser != "" then savedUser else "",
        loggedIn: savedUser != ""
    )

    (
        () => RHtml(div([
            h1("Login Demo"),
            if state.loggedIn then
                div([
                    p("Hello, " ++ state.username ++ "!"),
                    button("Logout", dataAction: "logout")
                ])
            else
                form([
                    input(inputType: "text", name: "username", placeholder: "Username"),
                    button("Login", btnType: "submit")
                ], dataAction: "login")
        ])),
        (action, params) => match action {
            "login" -> {
                username = Map.get(params, "username")
                # Set cookie via WebSocket - browser executes document.cookie
                rwebSetCookie(writerId, "user", username, 3600)  # 1 hour
                state.username = username
                state.loggedIn = true
            }
            "logout" -> {
                # Clear cookie via WebSocket
                rwebClearCookie(writerId, "user")
                state.username = ""
                state.loggedIn = false
            }
            _ -> ()
        }
    )
}

main() = startRWeb(8080, "Login Demo", appSession)</code></pre>
                </div>

                <div class="bg-slate-800/50 rounded-lg p-4 mb-6 border border-slate-700">
                    <h4 class="text-white font-semibold mb-2">WebSocket Cookie Functions (from stdlib.rweb)</h4>
                    <ul class="text-slate-400 text-sm space-y-2">
                        <li><code>rwebSetCookie(writerId, name, value, maxAge)</code> - Set cookie (maxAge in seconds)</li>
                        <li><code>rwebSetSecureCookie(writerId, name, value, maxAge)</code> - HTTPS with SameSite=Strict</li>
                        <li><code>rwebClearCookie(writerId, name)</code> - Delete cookie</li>
                    </ul>
                </div>

                <div class="bg-gradient-to-r from-yellow-900/30 to-orange-900/30 rounded-lg p-6 mb-6 border border-yellow-700/50">
                    <h4 class="text-yellow-400 font-semibold mb-2">Security Note</h4>
                    <p class="text-slate-300 text-sm">
                        Cookies set via <code>rwebSetCookie</code> are <strong>not HttpOnly</strong> (they're set via JavaScript). For sensitive authentication tokens, use the HTTP redirect approach with <code>setCookieWithAge</code> instead, which creates HttpOnly cookies that JavaScript cannot access.
                    </p>
                </div>

                <div class="bg-gradient-to-r from-emerald-900/30 to-teal-900/30 rounded-lg p-6 mb-8 border border-emerald-700/50">
                    <h4 class="text-emerald-400 font-semibold mb-2">Complete Secure Auth Example</h4>
                    <p class="text-slate-300 text-sm mb-3">
                        For a production-ready authentication pattern with HttpOnly cookies and server-side sessions, see:
                    </p>
                    <p class="text-slate-300 text-sm">
                        <code class="bg-slate-800 px-2 py-1 rounded">examples/rweb_secure_auth.nos</code>
                    </p>
                    <p class="text-slate-400 text-xs mt-3">
                        Features: HttpOnly cookies, server-side session storage, login/logout flow, protected routes, credential validation.
                    </p>
                </div>

                <!-- Passing Data Between Components -->
                <h2 class="text-2xl font-semibold text-white mb-4">Passing Data via Action Parameters</h2>
                <p class="text-slate-400 mb-4">
                    You can pass data from buttons using <code>data-param-*</code> attributes:
                </p>

                <div class="bg-nostos-code rounded-lg p-6 mb-8 border border-slate-800 overflow-x-auto">
<pre style="max-width:100%;overflow-x:auto"><code class="language-nostos">use stdlib.rweb
use stdlib.rhtml

reactive State = { selected: String }

session() = {
    state = State(selected: "none")

    (
        () => RHtml(div([
            h1("Item Selector"),
            p("Selected: " ++ state.selected),

            # Each button passes its item ID
            button("Apple", dataAction: "select", attrs: [("data-param-item", "apple")]),
            button("Banana", dataAction: "select", attrs: [("data-param-item", "banana")]),
            button("Cherry", dataAction: "select", attrs: [("data-param-item", "cherry")])
        ])),

        (action, params) => match action {
            "select" -> state.selected = Map.get(params, "item")
            _ -> ()
        }
    )
}

main() = startRWeb(8080, "Item Selector", session)</code></pre>
                </div>

                <!-- Complete Example: Todo App -->
                <h2 class="text-2xl font-semibold text-white mb-4">Complete Example: Todo Application</h2>
                <p class="text-slate-400 mb-4">
                    Here's a complete todo application demonstrating multiple reactive records, components, and various interactions:
                </p>

                <div class="bg-nostos-code rounded-lg p-6 mb-8 border border-slate-800 overflow-x-auto">
<pre style="max-width:100%;overflow-x:auto"><code class="language-nostos">use stdlib.rweb
use stdlib.rhtml
use stdlib.list

reactive Todo = { id: Int, text: String, done: Bool }
reactive AppState = {
    todos: List[Todo],
    nextId: Int,
    filter: String  # "all", "active", "done"
}

# Helper to create a todo item element
todoItem(todo: Todo) = div([
    span(
        todo.text ++ if todo.done then " [DONE]" else "",
        class: if todo.done then "line-through text-slate-500" else ""
    ),
    button("Toggle", dataAction: "toggle", attrs: [("data-param-id", show(todo.id))]),
    button("Delete", dataAction: "delete", attrs: [("data-param-id", show(todo.id))])
], class: "flex gap-2 items-center p-2 border-b border-slate-700")

session() = {
    state = AppState(todos: [], nextId: 1, filter: "all")

    # Filter todos based on current filter setting
    filteredTodos() = match state.filter {
        "active" -> state.todos.filter(t => !t.done)
        "done" -> state.todos.filter(t => t.done)
        _ -> state.todos
    }

    (
        () => RHtml(div([
            h1("Todo App"),

            # Add todo form
            form([
                input(inputType: "text", name: "text", placeholder: "What needs to be done?"),
                button("Add", btnType: "submit")
            ], dataAction: "addTodo"),

            # Stats component
            component("stats", () => RHtml(div([
                p("Total: " ++ show(List.length(state.todos))),
                p("Done: " ++ show(List.length(state.todos.filter(t => t.done))))
            ]))),

            # Filter buttons
            div([
                button("All", dataAction: "setFilter", attrs: [("data-param-filter", "all")]),
                button("Active", dataAction: "setFilter", attrs: [("data-param-filter", "active")]),
                button("Done", dataAction: "setFilter", attrs: [("data-param-filter", "done")]),
                p("Filter: " ++ state.filter)
            ]),

            # Todo list component
            component("todo-list", () => RHtml(div(
                filteredTodos().map(todoItem)
            )))
        ])),

        (action, params) => match action {
            "addTodo" -> {
                text = Map.get(params, "text")
                if String.length(text) > 0 then {
                    newTodo = Todo(id: state.nextId, text: text, done: false)
                    state.todos = state.todos ++ [newTodo]
                    state.nextId = state.nextId + 1
                } else ()
            }
            "toggle" -> {
                id = parseInt(Map.get(params, "id"))
                state.todos = state.todos.map(t =>
                    if t.id == id then { t.done = !t.done; t } else t
                )
            }
            "delete" -> {
                id = parseInt(Map.get(params, "id"))
                state.todos = state.todos.filter(t => t.id != id)
            }
            "setFilter" -> state.filter = Map.get(params, "filter")
            _ -> ()
        }
    )
}

main() = {
    println("Starting Todo app on port 8080...")
    startRWeb(8080, "Todo App", session)
}</code></pre>
                </div>

                <!-- Best Practices -->
                <h2 class="text-2xl font-semibold text-white mb-4">Best Practices</h2>

                <div class="space-y-6 mb-8">
                    <div class="bg-slate-800/50 rounded-lg p-5 border border-slate-700">
                        <h4 class="text-emerald-400 font-semibold mb-2">1. Use Components for Large UIs</h4>
                        <p class="text-slate-400 text-sm">Wrap sections of your UI in <code>component()</code> to enable targeted updates. Each component tracks its dependencies and only re-renders when those specific reactive fields change.</p>
                    </div>

                    <div class="bg-slate-800/50 rounded-lg p-5 border border-slate-700">
                        <h4 class="text-emerald-400 font-semibold mb-2">2. Keep Action Handlers Simple</h4>
                        <p class="text-slate-400 text-sm">Action handlers should just update state. Put complex logic in helper functions. The handler runs synchronously, so keep it fast.</p>
                    </div>

                    <div class="bg-slate-800/50 rounded-lg p-5 border border-slate-700">
                        <h4 class="text-emerald-400 font-semibold mb-2">3. Use Meaningful Component IDs</h4>
                        <p class="text-slate-400 text-sm">Component IDs become HTML element IDs. Use descriptive names like <code>"user-profile"</code> or <code>"cart-summary"</code> rather than generic names.</p>
                    </div>

                    <div class="bg-slate-800/50 rounded-lg p-5 border border-slate-700">
                        <h4 class="text-emerald-400 font-semibold mb-2">4. Separate Concerns with Multiple Records</h4>
                        <p class="text-slate-400 text-sm">Use separate reactive records for different parts of your state. This makes dependencies clearer and can improve update efficiency.</p>
                    </div>
                </div>

                <!-- External Push -->
                <h2 class="text-2xl font-semibold text-white mb-4">External Push: Server-Side Updates</h2>
                <p class="text-slate-400 mb-4">
                    RWeb supports pushing updates to connected clients from external processes. This is useful for:
                </p>
                <ul class="list-disc list-inside text-slate-400 mb-6 space-y-2">
                    <li>Real-time notifications from background workers</li>
                    <li>Broadcasting updates to specific sessions</li>
                    <li>Integrating with external systems (message queues, webhooks, etc.)</li>
                </ul>

                <h3 class="text-xl font-semibold text-white mb-3">How It Works</h3>
                <p class="text-slate-400 mb-4">
                    When a client connects, RWeb splits the WebSocket into separate read/write handles. The <code>writerId</code> is logged and can be used by any process to push messages:
                </p>
                <div class="bg-slate-800/50 rounded-lg p-4 mb-6 border border-slate-700 font-mono text-sm text-slate-300">
                    [RWeb] Session started: pid=&lt;pid 2&gt; writerId=<span class="text-emerald-400">123</span>
                </div>

                <h3 class="text-xl font-semibold text-white mb-3">Push Functions</h3>
                <p class="text-slate-400 mb-4">
                    Three helper functions are available for pushing content:
                </p>

                <div class="bg-nostos-code rounded-lg p-6 mb-6 border border-slate-800 overflow-x-auto">
<pre style="max-width:100%;overflow-x:auto"><code class="language-nostos"># Push a full page update (replaces entire rweb-root content)
rwebPushFull(writerId, "&lt;h1&gt;New Content&lt;/h1&gt;")

# Push a component update (updates specific component by ID)
rwebPushComponent(writerId, "notifications", "&lt;span&gt;You have 3 new messages&lt;/span&gt;")

# Push raw JSON message (for custom client-side handling)
rwebPushRaw(writerId, "{\"type\":\"custom\",\"data\":\"hello\"}")</code></pre>
                </div>

                <h3 class="text-xl font-semibold text-white mb-3">Example: Background Notification Pusher</h3>
                <p class="text-slate-400 mb-4">
                    Here's an example that sends notifications to a connected session from a background process:
                </p>

                <div class="bg-nostos-code rounded-lg p-6 mb-6 border border-slate-800 overflow-x-auto">
<pre style="max-width:100%;overflow-x:auto"><code class="language-nostos">use stdlib.rweb
use stdlib.rhtml

# Background worker that pushes notifications
notificationWorker(writerId) = {
    sleep(5000)  # Wait 5 seconds
    rwebPushComponent(writerId, "alerts",
        "&lt;div class='alert'&gt;New notification from server!&lt;/div&gt;")
    notificationWorker(writerId)  # Loop forever
}

# Main session with an alerts component
session() = {
    state = State(message: "Waiting...")
    (
        () => RHtml(div([
            h1("Push Demo"),
            component("alerts", () => RHtml(
                div("No alerts yet", class: "alerts")
            )),
            p(state.message)
        ])),
        (action, params) => ()
    )
}

# Note: In practice, you'd capture writerId from session logs
# or pass it via inter-process communication</code></pre>
                </div>

                <div class="bg-gradient-to-r from-blue-900/30 to-emerald-900/30 rounded-lg p-6 mb-8 border border-slate-700">
                    <h3 class="text-lg font-semibold text-white mb-2"> Full Example</h3>
                    <p class="text-slate-300">
                        See <a href="https://github.com/pegesund/nostos/blob/master/examples/rweb_external_push.nos" class="text-blue-400 hover:underline">examples/rweb_external_push.nos</a> for a complete working example demonstrating external push capabilities.
                    </p>
                </div>

                <h3 class="text-xl font-semibold text-white mb-3">Low-Level API</h3>
                <p class="text-slate-400 mb-4">
                    For advanced use cases, you can use the WebSocket builtins directly:
                </p>

                <div class="bg-nostos-code rounded-lg p-6 mb-8 border border-slate-800 overflow-x-auto">
<pre style="max-width:100%;overflow-x:auto"><code class="language-nostos"># Split a WebSocket into read/write handles
splitResult = WebSocket.split(ws)
requestId = splitResult.requestId   # For receiving messages
writerId = splitResult.writerId     # For sending (shareable)

# Send via shared writer (thread-safe, can be called from any process)
WebSocket.sendShared(writerId, "Hello from another process!")</code></pre>
                </div>

                <!-- Testing -->
                <h2 class="text-2xl font-semibold text-white mb-4">Testing RWeb Applications</h2>
                <p class="text-slate-400 mb-4">
                    RWeb applications can be tested using the Selenium WebDriver bindings. See the <a href="29_selenium.html" class="text-blue-400 hover:underline">Selenium chapter</a> for details. Here's a quick example:
                </p>

                <div class="bg-nostos-code rounded-lg p-6 mb-8 border border-slate-800 overflow-x-auto">
<pre style="max-width:100%;overflow-x:auto"><code class="language-nostos"># test_counter.nos - Test for the counter app
main() = {
    driver = Selenium.connect("http://localhost:4444")
    Selenium.goto(driver, "http://localhost:8080")
    Selenium.waitFor(driver, "button", 5000)

    # Test initial state
    text = Selenium.text(driver, "p")
    assert(String.contains(text, "Count: 0"))

    # Test increment
    Selenium.click(driver, "button")  # Click +1
    sleep(500)
    text = Selenium.text(driver, "p")
    assert(String.contains(text, "Count: 1"))

    Selenium.close(driver)
    println("All tests passed!")
    0
}</code></pre>
                </div>

                <!-- Navigation -->
                <div class="mt-12 pt-8 border-t border-slate-800 flex justify-between">
                    <a href="26_reactive_records.html" class="text-slate-400 hover:text-white transition flex items-center">
                        <span class="mr-2">&larr;</span> 25. Reactive Records
                    </a>
                    <a href="28_logging.html" class="text-slate-400 hover:text-white transition flex items-center">
                        27. Logging <span class="ml-2">&rarr;</span>
                    </a>
                </div>

            </div>
        </main>

    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="../js/nostos-highlight.js"></script>
    <script src="../js/tutorial-sidebar.js"></script>
    <script>hljs.highlightAll();</script>




</body>
</html>
