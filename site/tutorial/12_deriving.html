<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deriving - Nostos Tutorial</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <style>
        .hljs-operator {
            color: #e06c75; /* A distinct red/orange for operators */
        }
        .hljs-function {
            color: #e5c07b; /* A distinct yellow/gold for functions */
        }
    </style>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        nostos: {
                            dark: '#0f172a',
                            primary: '#3b82f6',
                            accent: '#10b981',
                            code: '#1e293b'
                        }
                    },
                    fontFamily: {
                        mono: ['ui-monospace', 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', "Liberation Mono", "Courier New", 'monospace'],
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-900 text-slate-200 font-sans antialiased">

    <!-- Navbar -->
    <nav class="border-b border-slate-800 bg-slate-900/80 backdrop-blur fixed w-full z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center">
                    <a href="../index.html" class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-emerald-400">Nostos</a>
                    <span class="ml-4 text-slate-400 border-l border-slate-700 pl-4 text-sm font-medium">Tutorial</span>
                </div>
                <div class="flex space-x-6">
                    <a href="../index.html" class="text-slate-400 hover:text-white transition">Home</a>
                    <a href="https://github.com/yourusername/nostos" class="text-slate-400 hover:text-white transition">GitHub</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="pt-16 flex min-h-screen">

        <!-- Sidebar -->
        <aside class="w-64 fixed h-full border-r border-slate-800 bg-slate-900 overflow-y-auto hidden md:block">
            <div class="p-6">
                <h3 class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-4">Contents</h3>
                <ul class="space-y-3">
                    <li><a href="01_basics.html" class="block text-slate-400 hover:text-white transition">1. Basics</a></li>
                    <li><a href="02_functions.html" class="block text-slate-400 hover:text-white transition">2. Functions</a></li>
                    <li><a href="03_pattern_matching.html" class="block text-slate-400 hover:text-white transition">3. Pattern Matching</a></li>
                    <li><a href="04_lists_tuples.html" class="block text-slate-400 hover:text-white transition">4. Lists & Tuples</a></li>
                    <li><a href="05_maps_sets.html" class="block text-slate-400 hover:text-white transition">5. Maps & Sets</a></li>
                    <li><a href="06_typed_arrays.html" class="block text-slate-400 hover:text-white transition">6. Typed Arrays</a></li>
                    <li><a href="07_concurrency.html" class="block text-slate-400 hover:text-white transition">7. Concurrency</a></li>
                    <li><a href="08_async_io_http.html" class="block text-slate-400 hover:text-white transition">8. Async I/O & HTTP</a></li>
                    <li><a href="09_type_system.html" class="block text-slate-400 hover:text-white transition">9. Type System</a></li>
                    <li><a href="10_error_handling.html" class="block text-slate-400 hover:text-white transition">10. Error Handling</a></li>
                    <li><a href="11_traits.html" class="block text-slate-400 hover:text-white transition">11. Traits</a></li>
                    <li><a href="12_deriving.html" class="block text-blue-400 font-medium">12. Deriving</a></li>
                    <li><a href="13_trait_bounds.html" class="block text-slate-400 hover:text-white transition">13. Trait Bounds</a></li>
                </ul>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 md:ml-64 p-8 max-w-4xl">
            <div class="mb-12">
                <h1 class="text-4xl font-bold text-white mb-6">Deriving</h1>
                <p class="text-lg text-slate-400 leading-relaxed mb-8">
                    Instead of manually implementing traits like <code class="text-emerald-400">Hash</code>, <code class="text-emerald-400">Eq</code>, <code class="text-emerald-400">Show</code>, or <code class="text-emerald-400">Copy</code>, you can use the <code class="text-emerald-400">deriving</code> keyword to have them generated automatically. This saves boilerplate and ensures consistent implementations.
                </p>

                <!-- Basic Syntax -->
                <h2 class="text-2xl font-semibold text-white mb-4">Basic Syntax</h2>
                <p class="text-slate-400 mb-4">Add <code class="text-emerald-400">deriving</code> after your type definition to automatically generate trait implementations.</p>
                <div class="bg-nostos-code rounded-lg p-6 mb-8 border border-slate-800 overflow-x-auto">
<pre><code class="language-nostos"># Derive a single trait
type Point = Point(Int, Int) deriving Hash

# Derive multiple traits using + to combine them
type Person = { name: String, age: Int } deriving (Hash + Show + Eq + Copy)
</code></pre>
                </div>

                <!-- Derivable Traits -->
                <h2 class="text-2xl font-semibold text-white mb-4">Derivable Traits</h2>
                <p class="text-slate-400 mb-4">Four traits can be automatically derived:</p>

                <div class="overflow-x-auto mb-8">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="border-b border-slate-700">
                                <th class="py-3 px-4 text-slate-300 font-semibold">Trait</th>
                                <th class="py-3 px-4 text-slate-300 font-semibold">Generated Function</th>
                                <th class="py-3 px-4 text-slate-300 font-semibold">Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-b border-slate-800">
                                <td class="py-3 px-4 text-emerald-400 font-mono">Hash</td>
                                <td class="py-3 px-4 text-slate-400 font-mono">hash(x) -> Int</td>
                                <td class="py-3 px-4 text-slate-400">Hash function for use in maps/sets</td>
                            </tr>
                            <tr class="border-b border-slate-800">
                                <td class="py-3 px-4 text-emerald-400 font-mono">Show</td>
                                <td class="py-3 px-4 text-slate-400 font-mono">show(x) -> String</td>
                                <td class="py-3 px-4 text-slate-400">String representation for debugging</td>
                            </tr>
                            <tr class="border-b border-slate-800">
                                <td class="py-3 px-4 text-emerald-400 font-mono">Eq</td>
                                <td class="py-3 px-4 text-slate-400 font-mono">==, != operators</td>
                                <td class="py-3 px-4 text-slate-400">Equality comparison</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4 text-emerald-400 font-mono">Copy</td>
                                <td class="py-3 px-4 text-slate-400 font-mono">copy(x) -> T</td>
                                <td class="py-3 px-4 text-slate-400">Deep copy of values</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Variant Types -->
                <h2 class="text-2xl font-semibold text-white mb-4">Deriving for Variant Types</h2>
                <p class="text-slate-400 mb-4">Deriving works with all kinds of variant (sum) types - from simple enums to complex variants with fields.</p>
                <div class="bg-nostos-code rounded-lg p-6 mb-8 border border-slate-800 overflow-x-auto">
<pre><code class="language-nostos"># Simple enum-like variants
type Color = Red | Green | Blue deriving (Hash + Show + Eq)

# Variants with fields
type Result = Ok(Int) | Err(String) deriving (Hash + Show + Eq + Copy)

# Complex variants
type Expression = Number(Int) | Variable(String) | Add(Expression, Expression) deriving (Eq + Show)

main() = {
    # Using derived Show
    println(show(Red))           # "Red"
    println(show(Ok(42)))        # "Ok(42)"

    # Using derived Eq
    println(show(Red == Red))    # true
    println(show(Red == Blue))   # false
}
</code></pre>
                </div>

                <!-- Record Types -->
                <h2 class="text-2xl font-semibold text-white mb-4">Deriving for Record Types</h2>
                <p class="text-slate-400 mb-4">Records with named fields also support deriving. The generated implementations use all fields.</p>
                <div class="bg-nostos-code rounded-lg p-6 mb-8 border border-slate-800 overflow-x-auto">
<pre><code class="language-nostos">type Person = { name: String, age: Int } deriving (Hash + Show + Eq + Copy)

main() = {
    alice = Person("Alice", 30)
    bob = Person("Bob", 25)
    alice2 = Person("Alice", 30)

    # Show displays all fields
    println(show(alice))  # Person { name: Alice, age: 30 }

    # Eq compares all fields
    println(show(alice == alice2))  # true
    println(show(alice == bob))     # false

    # Copy creates an independent copy
    copied = copy(alice)
    println(show(copied == alice))  # true
}
</code></pre>
                </div>

                <!-- Nested Types -->
                <h2 class="text-2xl font-semibold text-white mb-4">Nested Types</h2>
                <p class="text-slate-400 mb-4">When you derive traits for a type that contains another type, the inner type's derived methods are called automatically. This means composition works naturally.</p>
                <div class="bg-nostos-code rounded-lg p-6 mb-8 border border-slate-800 overflow-x-auto">
<pre><code class="language-nostos"># Inner types with derived traits
type Email = Email(String) deriving (Hash + Eq + Show)
type Address = { street: String, city: String, zip: Int } deriving (Hash + Eq + Show)

# Outer type that uses them
type Contact = { name: String, email: Email, address: Address } deriving (Hash + Eq + Show)

main() = {
    email = Email("alice@example.com")
    addr = Address("123 Main St", "Springfield", 12345)
    contact = Contact("Alice", email, addr)

    # Show recursively shows nested types
    println(show(contact))

    # Eq recursively compares nested types
    contact2 = Contact("Alice", Email("alice@example.com"), Address("123 Main St", "Springfield", 12345))
    println(show(contact == contact2))  # true
}
</code></pre>
                </div>

                <!-- Hash Consistency -->
                <h2 class="text-2xl font-semibold text-white mb-4">Hash Consistency</h2>
                <p class="text-slate-400 mb-4">The derived <code class="text-emerald-400">Hash</code> trait ensures that equal values always produce equal hash codes - a requirement for correct behavior in maps and sets.</p>
                <div class="bg-nostos-code rounded-lg p-6 mb-8 border border-slate-800 overflow-x-auto">
<pre><code class="language-nostos">type UserId = UserId(Int) deriving (Hash + Eq)

main() = {
    u1 = UserId(42)
    u2 = UserId(42)
    u3 = UserId(99)

    # Equal values have equal hashes
    println(show(hash(u1) == hash(u2)))  # true

    # Different values typically have different hashes
    println(show(hash(u1) == hash(u3)))  # false (usually)

    # This makes UserId usable as a map key
}
</code></pre>
                </div>

                <!-- Practical Example -->
                <h2 class="text-2xl font-semibold text-white mb-4">Practical Example: Custom Map Key</h2>
                <p class="text-slate-400 mb-4">Here's a practical example using derived traits to create a type suitable for use as a map key.</p>
                <div class="bg-nostos-code rounded-lg p-6 mb-8 border border-slate-800 overflow-x-auto">
<pre><code class="language-nostos">type UserId = UserId(Int) deriving (Hash + Eq + Show)
type UserData = { name: String, score: Int } deriving (Eq + Show)

# Simple association list lookup using derived Eq
lookup([], key) = "not found"
lookup([(k, v) | rest], key) = if k == key then v else lookup(rest, key)

main() = {
    users = [(UserId(1), UserData("Alice", 100)),
             (UserId(2), UserData("Bob", 85)),
             (UserId(3), UserData("Charlie", 92))]

    # lookup uses the derived == from Eq
    result = lookup(users, UserId(2))
    println(show(result))  # UserData { name: Bob, score: 85 }
}
</code></pre>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="flex justify-between border-t border-slate-800 pt-8">
                <a href="11_traits.html" class="flex items-center text-blue-400 hover:text-blue-300 font-medium transition">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m0 0h18"></path></svg>
                    Previous: Traits
                </a>
                <a href="13_trait_bounds.html" class="flex items-center text-blue-400 hover:text-blue-300 font-medium transition">
                    Next: Trait Bounds
                    <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m0 0H3"></path></svg>
                </a>
            </div>
        </main>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="../js/nostos-highlight.js"></script>
    <script>hljs.highlightAll();</script>
</body>
</html>
