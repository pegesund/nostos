<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Error Handling - Nostos Tutorial</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <style>
        .hljs-operator {
            color: #e06c75; /* A distinct red/orange for operators */
        }
        .hljs-function {
            color: #e5c07b; /* A distinct yellow/gold for functions */
        }
    </style>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        nostos: {
                            dark: '#0f172a',
                            primary: '#3b82f6',
                            accent: '#10b981',
                            code: '#1e293b'
                        }
                    },
                    fontFamily: {
                        mono: ['ui-monospace', 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', "Liberation Mono", "Courier New", 'monospace'],
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-900 text-slate-200 font-sans antialiased">

    <!-- Navbar -->
    <nav class="border-b border-slate-800 bg-slate-900/80 backdrop-blur fixed w-full z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center">
                    <a href="../index.html" class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-emerald-400">Nostos</a>
                    <span class="ml-4 text-slate-400 border-l border-slate-700 pl-4 text-sm font-medium">Tutorial</span>
                </div>
                <div class="flex space-x-6">
                    <a href="../index.html" class="text-slate-400 hover:text-white transition">Home</a>
                    <a href="https://github.com/yourusername/nostos" class="text-slate-400 hover:text-white transition">GitHub</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="pt-16 flex min-h-screen">
        
        <!-- Sidebar -->
        <aside class="w-64 fixed h-full border-r border-slate-800 bg-slate-900 overflow-y-auto hidden md:block">
            <div class="p-6">
                <h3 class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-4">Contents</h3>
                <ul class="space-y-3">
                    <li><a href="01_basics.html" class="block text-slate-400 hover:text-white transition">1. Basics</a></li>
                    <li><a href="02_functions.html" class="block text-slate-400 hover:text-white transition">2. Functions</a></li>
                    <li><a href="03_pattern_matching.html" class="block text-slate-400 hover:text-white transition">3. Pattern Matching</a></li>
                    <li><a href="04_lists_tuples.html" class="block text-slate-400 hover:text-white transition">4. Lists & Tuples</a></li>
                    <li><a href="05_maps_sets.html" class="block text-slate-400 hover:text-white transition">5. Maps & Sets</a></li>
                    <li><a href="06_typed_arrays.html" class="block text-slate-400 hover:text-white transition">6. Typed Arrays</a></li>
                    <li><a href="07_concurrency.html" class="block text-slate-400 hover:text-white transition">7. Concurrency</a></li>
                    <li><a href="08_async_io_http.html" class="block text-slate-400 hover:text-white transition">8. Async I/O & HTTP</a></li>
                    <li><a href="09_type_system.html" class="block text-slate-400 hover:text-white transition">9. Type System</a></li>
                    <li><a href="10_error_handling.html" class="block text-blue-400 font-medium">10. Error Handling</a></li>
                    <li><a href="11_traits.html" class="block text-slate-400 hover:text-white transition">11. Traits</a></li>
                    <li><a href="12_deriving.html" class="block text-slate-400 hover:text-white transition">12. Builtin Traits</a></li>
                    <li><a href="13_trait_bounds.html" class="block text-slate-400 hover:text-white transition">13. Trait Bounds</a></li>
                    <li><a href="14_json.html" class="block text-slate-400 hover:text-white transition">14. JSON</a></li>
                    <li><a href="15_stdlib.html" class="block text-slate-400 hover:text-white transition">15. Standard Library</a></li>
                    <li><a href="16_reflection.html" class="block text-slate-400 hover:text-white transition">16. Reflection & Eval</a></li>
                </ul>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 md:ml-64 p-8 max-w-4xl">
            <div class="mb-12">
                <h1 class="text-4xl font-bold text-white mb-6">Error Handling</h1>
                <p class="text-lg text-slate-400 leading-relaxed mb-8">
                    Nostos provides multiple ways to handle errors. For most everyday code, <code>try/catch</code> with <code>throw</code> is the simplest approach. For more structured error handling, you can use the <code>Option</code> and <code>Result</code> types.
                </p>

                <!-- Try/Catch - The Everyday Approach -->
                <h2 class="text-2xl font-semibold text-white mb-4"><code>try/catch</code> - The Everyday Approach</h2>
                <p class="text-slate-400 mb-4">
                    The simplest way to handle errors in Nostos is <code>try/catch</code>. Wrap code that might fail in a <code>try</code> block, and handle errors in the <code>catch</code> block.
                </p>
                <div class="bg-nostos-code rounded-lg p-6 mb-8 border border-slate-800 overflow-x-auto">
<pre><code class="language-nostos"># Basic try/catch
main() = {
    result = try {
        data = File.readAll("/etc/config.txt")
        println("Got: " ++ data)
        data
    } catch { e ->
        println("Failed: " ++ e)
        "default value"
    }
}

# Multiple operations in one try block
process_request(url) = {
    try {
        response = Http.get(url)
        parsed = Json.parse(response.body)
        save_to_db(parsed)
        "success"
    } catch { e ->
        log_error(e)
        "failed"
    }
}</code></pre>
                </div>

                <p class="text-slate-400 mb-4">
                    All I/O operations (files, network, database) throw on error, so you'll use <code>try/catch</code> frequently:
                </p>
                <div class="bg-nostos-code rounded-lg p-6 mb-8 border border-slate-800 overflow-x-auto">
<pre><code class="language-nostos"># File operations
read_config(path) = {
    try {
        File.readAll(path)
    } catch { _ ->
        "{}"  # Return empty JSON on error
    }
}

# HTTP requests
fetch_user(id) = {
    try {
        resp = Http.get("https://api.example.com/users/" ++ id.show())
        Some(resp.body)
    } catch { e ->
        println("API error: " ++ e)
        None
    }
}

# Database queries
get_orders(user_id) = {
    try {
        Pg.query(conn, "SELECT * FROM orders WHERE user_id = $1", [user_id])
    } catch { e ->
        println("DB error: " ++ e)
        []
    }
}</code></pre>
                </div>

                <!-- Throw -->
                <h2 class="text-2xl font-semibold text-white mb-4"><code>throw</code> - Raising Errors</h2>
                <p class="text-slate-400 mb-4">
                    Use <code>throw</code> to signal an error that callers should handle. You can throw any value - strings are common, but you can also throw custom error types.
                </p>
                <div class="bg-nostos-code rounded-lg p-6 mb-8 border border-slate-800 overflow-x-auto">
<pre><code class="language-nostos"># Throw a string
divide(a, b) =
    if b == 0 then throw("division by zero")
    else a / b

# Throw a custom error type
type ValidationError = { field: String, message: String }

validate_email(email) =
    if not email.contains?("@") then
        throw(ValidationError("email", "must contain @"))
    else email

# Caller catches the error
main() = {
    result = try {
        x = divide(10, 0)
        x * 2
    } catch { e ->
        println("Error: " ++ e)
        0
    }
}</code></pre>
                </div>

                <!-- Panic -->
                <h2 class="text-2xl font-semibold text-white mb-4"><code>panic</code> - Bugs and Impossible States</h2>
                <p class="text-slate-400 mb-4">
                    Use <code>panic</code> for programmer errors - situations that should <em>never</em> happen if the code is correct. Unlike <code>throw</code>, panics are not meant to be caught.
                </p>
                <div class="bg-nostos-code rounded-lg p-6 mb-8 border border-slate-800 overflow-x-auto">
<pre><code class="language-nostos"># Panic on impossible state
get_first(list) = match list {
    [x | _] -> x
    [] -> panic("get_first called on empty list")
}

# Panic on invariant violation
set_age(age) =
    if age < 0 then panic("age cannot be negative: " ++ age.show())
    else age

# Unwrap - panic if None
unwrap(Some(x)) = x
unwrap(None) = panic("unwrap called on None")</code></pre>
                </div>

                <div class="bg-gradient-to-r from-yellow-900/20 to-orange-900/20 rounded-lg p-6 mb-8 border border-yellow-800/30">
                    <h3 class="text-lg font-semibold text-white mb-3">throw vs panic</h3>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <h4 class="text-blue-400 font-medium mb-2">throw</h4>
                            <ul class="text-slate-400 text-sm space-y-1">
                                <li>• Expected failures (network, file, validation)</li>
                                <li>• Caller should handle it</li>
                                <li>• Can be caught with try/catch</li>
                                <li>• Part of normal control flow</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="text-red-400 font-medium mb-2">panic</h4>
                            <ul class="text-slate-400 text-sm space-y-1">
                                <li>• Bugs and impossible states</li>
                                <li>• Should never happen in correct code</li>
                                <li>• Not meant to be caught</li>
                                <li>• Terminates the process</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Option Type -->
                <h2 class="text-2xl font-semibold text-white mb-4"><code>Option</code> - When Values Might Be Absent</h2>
                <p class="text-slate-400 mb-4">
                    Nostos has no <code>null</code>. Instead, use <code>Option[T]</code> to represent values that might not exist. This forces you to handle the "nothing" case explicitly.
                </p>
                <div class="bg-nostos-code rounded-lg p-6 mb-8 border border-slate-800 overflow-x-auto">
<pre><code class="language-nostos">type Option[T] = Some(T) | None

# Functions that might not find something return Option
find_user(id) =
    if id == 1 then Some("Alice")
    else if id == 2 then Some("Bob")
    else None

main() = {
    # Handle with pattern matching
    match find_user(1) {
        Some(name) -> println("Found: " ++ name)
        None -> println("User not found")
    }

    # Or use unwrapOr for a default
    name = find_user(99).unwrapOr("Guest")
    println(name)  # "Guest"
}</code></pre>
                </div>

                <!-- Result Type -->
                <h2 class="text-2xl font-semibold text-white mb-4"><code>Result</code> - Typed Error Handling</h2>
                <p class="text-slate-400 mb-4">
                    For pure functions where you want typed errors (not exceptions), use <code>Result[T, E]</code>. This is useful when you need to pass error information up the call stack in a structured way.
                </p>
                <div class="bg-nostos-code rounded-lg p-6 mb-8 border border-slate-800 overflow-x-auto">
<pre><code class="language-nostos">type Result[T, E] = Ok(T) | Err(E)

type ParseError = { line: Int, message: String }

parse_number(s) = {
    if s.all?(c => c.isDigit?()) then Ok(s.toInt())
    else Err(ParseError(1, "not a number: " ++ s))
}

main() = {
    match parse_number("42") {
        Ok(n) -> println("Got: " ++ n.show())
        Err(e) -> println("Error at line " ++ e.line.show() ++ ": " ++ e.message)
    }
}</code></pre>
                </div>

                <!-- The ? Operator -->
                <h2 class="text-2xl font-semibold text-white mb-4">The <code>?</code> Operator - Propagating Results</h2>
                <p class="text-slate-400 mb-4">
                    When chaining operations that return <code>Result</code>, use <code>?</code> to propagate errors automatically. If the result is <code>Err</code>, it returns immediately; if <code>Ok</code>, it unwraps the value.
                </p>
                <div class="bg-nostos-code rounded-lg p-6 mb-8 border border-slate-800 overflow-x-auto">
<pre><code class="language-nostos">parse_config(text) = {
    # Each ? will return Err early if parsing fails
    port = parse_number(get_field(text, "port"))?
    timeout = parse_number(get_field(text, "timeout"))?
    Ok(Config(port, timeout))
}

main() = {
    match parse_config(config_text) {
        Ok(config) -> start_server(config)
        Err(e) -> println("Config error: " ++ e.message)
    }
}</code></pre>
                </div>

                <!-- When to Use What -->
                <h2 class="text-2xl font-semibold text-white mb-4">When to Use What</h2>
                <div class="bg-gradient-to-r from-blue-900/20 to-emerald-900/20 rounded-lg p-6 mb-8 border border-blue-800/30">
                    <div class="space-y-4">
                        <div>
                            <h4 class="text-emerald-400 font-medium mb-1">Use <code>try/catch</code> + <code>throw</code> for:</h4>
                            <p class="text-slate-400 text-sm">I/O operations (files, HTTP, database), validation errors, API errors, and most everyday error handling. This is the simplest and most common approach.</p>
                        </div>
                        <div>
                            <h4 class="text-red-400 font-medium mb-1">Use <code>panic</code> for:</h4>
                            <p class="text-slate-400 text-sm">Bugs, violated invariants, and impossible states. If you're tempted to write "this should never happen", use panic.</p>
                        </div>
                        <div>
                            <h4 class="text-blue-400 font-medium mb-1">Use <code>Option</code> for:</h4>
                            <p class="text-slate-400 text-sm">Lookups that might not find anything, optional configuration, and anywhere a value might legitimately be absent.</p>
                        </div>
                        <div>
                            <h4 class="text-purple-400 font-medium mb-1">Use <code>Result</code> for:</h4>
                            <p class="text-slate-400 text-sm">Pure parsing/validation functions, libraries that want to give callers full control, and when you need typed error information that propagates through function calls.</p>
                        </div>
                    </div>
                </div>

                <div class="bg-slate-800/50 rounded-lg p-4 mb-8 border border-slate-700">
                    <p class="text-slate-400 text-sm"><strong>Tip:</strong> Start with <code>try/catch</code>. It's simple and handles most cases. Reach for <code>Option</code> and <code>Result</code> when you need more structure - you'll know when you need them.</p>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="flex justify-between border-t border-slate-800 pt-8">
                <a href="09_type_system.html" class="flex items-center text-blue-400 hover:text-blue-300 font-medium transition">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m0 0h18"></path></svg>
                    Previous: Type System
                </a>
                <a href="11_traits.html" class="flex items-center text-blue-400 hover:text-blue-300 font-medium transition">
                    Next: Traits
                    <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m0 0h18"></path></svg>
                </a>
            </div>
        </main>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="../js/nostos-highlight.js"></script>
    <script>hljs.highlightAll();</script>
</body>
