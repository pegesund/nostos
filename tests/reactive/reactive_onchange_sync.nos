# expect: [x:0->1, y:0->2, x:1->3]
# Test that onChange callbacks run synchronously in order

reactive Point = { x: Int, y: Int }

mvar log: List[String] = []

main() = {
    p = Point(x: 0, y: 0)

    # Register a callback that appends to log
    p.onChange((fieldName, oldVal, newVal) => {
        log = log ++ [fieldName ++ ":" ++ show(oldVal) ++ "->" ++ show(newVal)]
    })

    # Multiple field changes - callbacks run synchronously after each
    p.x = 1
    p.y = 2
    p.x = 3

    # Log should have all three entries in order
    log
}
