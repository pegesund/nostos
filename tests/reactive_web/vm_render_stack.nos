# expect: comp-1
# Test VM-level render stack for automatic dependency tracking

reactive Counter = { value: Int }

main() = {
    # Create a reactive record
    counter = Counter(value: 0)

    # Push component onto render stack
    RenderStack.push("comp-1")

    # Reading the reactive record while rendering should track dependency
    _ = counter.value

    # Pop the render stack
    RenderStack.pop()

    # Now writing to the reactive record should queue the component for re-render
    counter.value = 42

    # Flush pending re-renders (using VM builtin)
    pending = Reactive.flushPending()
    match pending {
        [id] -> id
        [] -> "none"
        _ -> "multiple"
    }
}
