# expect: 1
# Test ancestor deduplication - only root component should re-render

import stdlib.reactiveWeb

main() = {
    resetSession()

    # Render nested components where both track the same var
    result = rwRenderRoot("parent", (parentId) => {
        trackRead("sharedVar")
        child = renderWith("child", parentId, (childId) => {
            trackRead("sharedVar")
            Text("Child")
        })
        Element("div", [], [child.html])
    })

    # Both parent and child depend on "sharedVar"
    # But only parent should be in the re-render list (child is its descendant)
    toRerender = getComponentsToRerender("sharedVar")
    length(toRerender)
}
