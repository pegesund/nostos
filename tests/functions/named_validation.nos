# expect: 0
# Validation functions with named/default params

type CheckResult = Pass | Fail(String)

# Check bounds with defaults
checkBounds(value, min = 0, max = 100, fieldName = "value") =
    if value < min then Fail(fieldName ++ " too small")
    else if value > max then Fail(fieldName ++ " too large")
    else Pass

test1() = checkBounds(50) == Pass
test2() = checkBounds(-1) == Fail("value too small")
test3() = checkBounds(101) == Fail("value too large")
test4() = checkBounds(50, min: 60) == Fail("value too small")
test5() = checkBounds(150, max: 200) == Pass
test6() = checkBounds(-5, fieldName: "age") == Fail("age too small")

# Check string length with defaults
checkLength(s, minLen = 1, maxLen = 100, fieldName = "string") =
    if s.length() < minLen then Fail(fieldName ++ " too short")
    else if s.length() > maxLen then Fail(fieldName ++ " too long")
    else Pass

test7() = checkLength("hello") == Pass
test8() = checkLength("") == Fail("string too short")
test9() = checkLength("hi", minLen: 5) == Fail("string too short")
test10() = checkLength("hello", maxLen: 3) == Fail("string too long")
test11() = checkLength("", fieldName: "name", minLen: 1) == Fail("name too short")

# Check if valid
isValid(result) = match result {
    Pass -> true
    Fail(_) -> false
}

# Combine validations
validateAll(results = []) =
    if length(results) == 0 then Pass
    else {
        invalids = results.filter(r => !isValid(r))
        if length(invalids) == 0 then Pass
        else head(invalids)
    }

test12() = validateAll() == Pass
test13() = validateAll([Pass, Pass]) == Pass
test14() = validateAll([Pass, Fail("error"), Pass]) == Fail("error")

# Validate record-like data
validatePerson(age = 0, name = "", email = "") = {
    ageCheck = checkBounds(age, 0, 150, "age")
    nameCheck = checkLength(name, 1, 50, "name")
    emailCheck = checkLength(email, 5, 100, "email")
    validateAll([ageCheck, nameCheck, emailCheck])
}

test15() = validatePerson(25, "Alice", "alice@example.com") == Pass
test16() = validatePerson(name: "Bob", age: 30, email: "bob@x.com") == Pass
test17() = validatePerson(-1, "Test", "test@test.com") == Fail("age too small")
test18() = validatePerson(age: 25, name: "", email: "test@test.com") == Fail("name too short")

main() = {
    results = [test1(), test2(), test3(), test4(), test5(), test6(),
               test7(), test8(), test9(), test10(), test11(), test12(),
               test13(), test14(), test15(), test16(), test17(), test18()]
    passed = results.filter(r => r)
    if length(passed) == 18 then 0 else 1
}
