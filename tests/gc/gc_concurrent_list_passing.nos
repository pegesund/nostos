# expect: ()
# GC handles lists passed between processes

sum_list([]) = 0
sum_list([h | t]) = h + sum_list(t)

worker(parent, lst) = {
    # Create garbage while processing
    garbage = [99, 88, 77, 66, 55]
    result = sum_list(lst)
    parent <- result
}

main() = {
    me = self()

    # Spawn workers with different lists
    spawn { worker(me, [1, 2, 3, 4, 5]) }
    spawn { worker(me, [10, 20, 30]) }
    spawn { worker(me, [100, 200]) }
    spawn { worker(me, [1000]) }

    # Collect all results
    var total = 0
    for i = 0 to 4 {
        total = receive
            r -> total + r
        end
    }

    # 15 + 60 + 300 + 1000 = 1375
    assert_eq(1375, total)
}
