# expect: 0
# GC handles variants passed between processes

type Result = Ok(Int) | Err(String)

worker(parent, r) = {
    garbage = Ok(9999)
    result = match r {
        Ok(n) -> n
        Err(_) -> 0
    }
    parent <- result
}

main() = {
    me = self()

    # Create variants and pass to workers
    spawn { worker(me, Ok(100)) }
    spawn { worker(me, Ok(200)) }
    spawn { worker(me, Err("error")) }
    spawn { worker(me, Ok(300)) }
    spawn { worker(me, Err("another")) }

    # Collect results
    var total = 0
    for i = 0 to 5 {
        total = receive { r -> total + r }
    }

    # 100 + 200 + 0 + 300 + 0 = 600
    assert_eq(600, total)
    0
}
