# expect: ()
# Simple state threading simulation

# Run computation with state, return (result, final_state)
# Using tuple to thread state through

# Increment state, return old value
get_and_inc(state) = (state, state + 1)

# Chain two stateful computations
chain((r1, s1), f) = f(s1)

main() = {
    # Start with state 0
    # Get values and thread state through
    # Note: consecutive tuple patterns need commas for parser disambiguation
    (v1, s1) = get_and_inc(0),
    (v2, s2) = get_and_inc(s1),
    (v3, s3) = get_and_inc(s2),
    (v4, s4) = get_and_inc(s3),
    (v5, s5) = get_and_inc(s4),
    (v6, s6) = get_and_inc(s5)

    # v1=0, v2=1, v3=2, v4=3, v5=4, v6=5
    # Sum: 0+1+2+3 = 6, s4 = 4
    result = (v1 + v2 + v3 + v4, s4)
    assert_eq((6, 4), result)
}
