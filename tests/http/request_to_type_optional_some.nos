# expect: 42
# Test requestToType builtin - optional fields with values become Some

type Result[T, E] = Ok(T) | Err(E)
type Option[T] = Some(T) | None

type UserParams = { name: String, age: Option[Int] }

type HttpRequest = { id: Int, method: String, path: String, headers: List[(String, String)], body: String, queryParams: List[(String, String)], cookies: List[(String, String)], formParams: List[(String, String)], isWebSocket: Bool }

main() = {
    # 'age' parameter present - should become Some(42)
    req = HttpRequest(1, "GET", "/test", [], "", [("name", "Alice"), ("age", "42")], [], [], false)
    result: Result[UserParams, String] = requestToType(req, "UserParams")
    match result {
        Ok(params) -> match params.age {
            Some(n) -> n
            None -> -1
        }
        Err(msg) -> -2
    }
}
