use stdlib.rhtml

# expect: true
# Test that updateState correctly tracks deps after re-rendering

reactive User = { name: String }
reactive Theme = { color: String }

main() = {
    user = User("Alice")
    theme = Theme("dark")

    userComp = () => RHtml(span(user.name))
    themeComp = () => RHtml(span(theme.color))

    result = RHtml(div([
        component("user-comp", userComp),
        component("theme-comp", themeComp)
    ]))

    # Get initial affected components
    initialUserAffected = affectedComponents(result.deps, reactiveId(user))
    hasUserComp = listContainsStr(initialUserAffected, "user-comp")

    initialThemeAffected = affectedComponents(result.deps, reactiveId(theme))
    hasThemeComp = listContainsStr(initialThemeAffected, "theme-comp")

    # Update state when user changes
    newState = updateState(result, [reactiveId(user)])

    # User-comp should still be in deps (re-rendered and read user again)
    newUserAffected = affectedComponents(newState.deps, reactiveId(user))
    stillHasUserComp = listContainsStr(newUserAffected, "user-comp")

    # Theme-comp should still be there (was not affected, not re-rendered)
    newThemeAffected = affectedComponents(newState.deps, reactiveId(theme))
    stillHasThemeComp = listContainsStr(newThemeAffected, "theme-comp")

    hasUserComp && hasThemeComp && stillHasUserComp && stillHasThemeComp
}
