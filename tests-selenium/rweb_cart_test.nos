# RWeb Shopping Cart for Selenium Testing

use stdlib.rweb
use stdlib.rhtml

reactive QtyA = { value: Int }
reactive QtyB = { value: Int }
reactive Discount = { value: Int }

session() = {
    qtyA = QtyA(0)
    qtyB = QtyB(0)
    discount = Discount(0)

    (
        () => RHtml(div([
            h1("Shopping Cart"),
            component("item-a", () => RHtml(
                div([
                    span("Item A ($10): "),
                    button("-", dataAction: "dec-a", dataTestid: "dec-a"),
                    span(" " ++ show(qtyA.value) ++ " ", dataTestid: "qty-a"),
                    button("+", dataAction: "inc-a", dataTestid: "inc-a"),
                    span(" = $" ++ show(qtyA.value * 10), dataTestid: "subtotal-a")
                ], dataTestid: "a-row")
            )),
            component("item-b", () => RHtml(
                div([
                    span("Item B ($25): "),
                    button("-", dataAction: "dec-b", dataTestid: "dec-b"),
                    span(" " ++ show(qtyB.value) ++ " ", dataTestid: "qty-b"),
                    button("+", dataAction: "inc-b", dataTestid: "inc-b"),
                    span(" = $" ++ show(qtyB.value * 25), dataTestid: "subtotal-b")
                ], dataTestid: "b-row")
            )),
            component("totals", () => RHtml(
                div([
                    div("Subtotal: $" ++ show(qtyA.value * 10 + qtyB.value * 25), dataTestid: "subtotal"),
                    div("Discount: " ++ show(discount.value) ++ "%", dataTestid: "discount-display"),
                    div("Total: $" ++ show((qtyA.value * 10 + qtyB.value * 25) * (100 - discount.value) / 100), dataTestid: "total")
                ], dataTestid: "totals")
            )),
            div([
                button("10%", dataAction: "discount-10", dataTestid: "discount-10"),
                button("50%", dataAction: "discount-50", dataTestid: "discount-50")
            ]),
            component("summary", () => RHtml(
                div("Items: " ++ show(qtyA.value + qtyB.value), dataTestid: "summary")
            )),
            button("Clear", dataAction: "clear", dataTestid: "clear-cart")
        ])),
        (action, params) => match action {
            "inc-a" -> { qtyA.value = qtyA.value + 1 }
            "dec-a" -> { qtyA.value = max(0, qtyA.value - 1) }
            "inc-b" -> { qtyB.value = qtyB.value + 1 }
            "dec-b" -> { qtyB.value = max(0, qtyB.value - 1) }
            "discount-10" -> { discount.value = 10 }
            "discount-50" -> { discount.value = 50 }
            "clear" -> { qtyA.value = 0; qtyB.value = 0; discount.value = 0 }
            _ -> ()
        }
    )
}

main() = startRWeb(8097, "RWeb Cart Test", session)
