# RWeb Shopping Cart for Selenium Testing

use stdlib.rweb
use stdlib.rhtml

reactive QtyA = { value: Int }
reactive QtyB = { value: Int }
reactive Discount = { value: Int }

session() = {
    qtyA = QtyA(0)
    qtyB = QtyB(0)
    discount = Discount(0)

    (
        () => RHtml(div([
            h1("Shopping Cart"),
            component("item-a", () => RHtml(
                div([attr("data-testid", "a-row")], [
                    span("Item A ($10): "),
                    button([attr("data-action", "dec-a"), attr("data-testid", "dec-a")], "-"),
                    span([attr("data-testid", "qty-a")], " " ++ show(qtyA.value) ++ " "),
                    button([attr("data-action", "inc-a"), attr("data-testid", "inc-a")], "+"),
                    span([attr("data-testid", "subtotal-a")], " = $" ++ show(qtyA.value * 10))
                ])
            )),
            component("item-b", () => RHtml(
                div([attr("data-testid", "b-row")], [
                    span("Item B ($25): "),
                    button([attr("data-action", "dec-b"), attr("data-testid", "dec-b")], "-"),
                    span([attr("data-testid", "qty-b")], " " ++ show(qtyB.value) ++ " "),
                    button([attr("data-action", "inc-b"), attr("data-testid", "inc-b")], "+"),
                    span([attr("data-testid", "subtotal-b")], " = $" ++ show(qtyB.value * 25))
                ])
            )),
            component("totals", () => RHtml(
                div([attr("data-testid", "totals")], [
                    div([attr("data-testid", "subtotal")], "Subtotal: $" ++ show(qtyA.value * 10 + qtyB.value * 25)),
                    div([attr("data-testid", "discount-display")], "Discount: " ++ show(discount.value) ++ "%"),
                    div([attr("data-testid", "total")], "Total: $" ++ show((qtyA.value * 10 + qtyB.value * 25) * (100 - discount.value) / 100))
                ])
            )),
            div([
                button([attr("data-action", "discount-10"), attr("data-testid", "discount-10")], "10%"),
                button([attr("data-action", "discount-50"), attr("data-testid", "discount-50")], "50%")
            ]),
            component("summary", () => RHtml(
                div([attr("data-testid", "summary")], "Items: " ++ show(qtyA.value + qtyB.value))
            )),
            button([attr("data-action", "clear"), attr("data-testid", "clear-cart")], "Clear")
        ])),
        (action, params) => match action {
            "inc-a" -> { qtyA.value = qtyA.value + 1 }
            "dec-a" -> { qtyA.value = max(0, qtyA.value - 1) }
            "inc-b" -> { qtyB.value = qtyB.value + 1 }
            "dec-b" -> { qtyB.value = max(0, qtyB.value - 1) }
            "discount-10" -> { discount.value = 10 }
            "discount-50" -> { discount.value = 50 }
            "clear" -> { qtyA.value = 0; qtyB.value = 0; discount.value = 0 }
            _ -> ()
        }
    )
}

main() = startRWeb(8097, "RWeb Cart Test", session)
