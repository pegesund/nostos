# RWeb Multi-Counter for Selenium Testing
# Tests: multiple independent reactive records, cross-component interactions

use stdlib.rweb
use stdlib.rhtml

reactive CounterA = { value: Int }
reactive CounterB = { value: Int }
reactive CounterC = { value: Int }

session() = {
    counterA = CounterA(0)
    counterB = CounterB(0)
    counterC = CounterC(0)

    (
        # renderPage
        () => RHtml(div([
            h1("Multi-Counter Test"),

            component("counter-a", () => RHtml(
                div([
                    h3("Counter A"),
                    button("-", dataAction: "dec-a", dataTestid: "dec-a"),
                    span(" " ++ show(counterA.value) ++ " ", dataTestid: "value-a"),
                    button("+", dataAction: "inc-a", dataTestid: "inc-a")
                ], dataTestid: "counter-a")
            )),

            component("counter-b", () => RHtml(
                div([
                    h3("Counter B"),
                    button("-", dataAction: "dec-b", dataTestid: "dec-b"),
                    span(" " ++ show(counterB.value) ++ " ", dataTestid: "value-b"),
                    button("+", dataAction: "inc-b", dataTestid: "inc-b")
                ], dataTestid: "counter-b")
            )),

            component("counter-c", () => RHtml(
                div([
                    h3("Counter C"),
                    button("-", dataAction: "dec-c", dataTestid: "dec-c"),
                    span(" " ++ show(counterC.value) ++ " ", dataTestid: "value-c"),
                    button("+", dataAction: "inc-c", dataTestid: "inc-c")
                ], dataTestid: "counter-c")
            )),

            component("total", () => RHtml(
                div([
                    div("Total: " ++ show(counterA.value + counterB.value + counterC.value), dataTestid: "computed-total")
                ], dataTestid: "total-section")
            )),

            div([
                button("A->B", dataAction: "copy-a-to-b", dataTestid: "copy-a-to-b"),
                button("B->C", dataAction: "copy-b-to-c", dataTestid: "copy-b-to-c"),
                button("B+C->A", dataAction: "sum-to-a", dataTestid: "sum-to-a"),
                button("Reset", dataAction: "reset-all", dataTestid: "reset-all")
            ], dataTestid: "cross-ops"),

            component("summary", () => RHtml(
                div([
                    span("A=" ++ show(counterA.value) ++ " B=" ++ show(counterB.value) ++ " C=" ++ show(counterC.value))
                ], dataTestid: "summary")
            ))
        ])),

        # onAction
        (action, params) => match action {
            "inc-a" -> { counterA.value = counterA.value + 1 }
            "dec-a" -> { counterA.value = counterA.value - 1 }
            "inc-b" -> { counterB.value = counterB.value + 1 }
            "dec-b" -> { counterB.value = counterB.value - 1 }
            "inc-c" -> { counterC.value = counterC.value + 1 }
            "dec-c" -> { counterC.value = counterC.value - 1 }
            "copy-a-to-b" -> { counterB.value = counterA.value }
            "copy-b-to-c" -> { counterC.value = counterB.value }
            "sum-to-a" -> { counterA.value = counterB.value + counterC.value }
            "reset-all" -> { counterA.value = 0; counterB.value = 0; counterC.value = 0 }
            _ -> ()
        }
    )
}

main() = startRWeb(8098, "RWeb Multi-Counter Test", session)
