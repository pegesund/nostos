# RWeb Counter with External Functions
# Tests that reactive records can be passed to and mutated by external functions

use stdlib.rweb
use stdlib.rhtml

reactive Counter = { value: Int }

# External helper functions that take reactive record as parameter
increment(c) = { c.value = c.value + 1 }
decrement(c) = { c.value = c.value - 1 }
addAmount(c, n) = { c.value = c.value + n }
resetTo(c, n) = { c.value = n }

session() = {
    counter = Counter(0)

    (
        () => RHtml(div([
            h1("External Function Test"),
            component("display", () => RHtml(
                div("Count: " ++ show(counter.value), dataTestid: "count")
            )),
            div([
                button("+", dataAction: "inc", dataTestid: "inc"),
                button("-", dataAction: "dec", dataTestid: "dec"),
                button("+5", dataAction: "add5", dataTestid: "add5"),
                button("Reset", dataAction: "reset", dataTestid: "reset")
            ])
        ])),

        (action, params) => match action {
            "inc" -> increment(counter)
            "dec" -> decrement(counter)
            "add5" -> addAmount(counter, 5)
            "reset" -> resetTo(counter, 0)
            _ -> ()
        }
    )
}

main() = startRWeb(8099, "External Function Test", session)
